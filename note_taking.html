<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discover Your Note-Taking Method</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        // Interactive functions for all walkthroughs - Moved to global scope

        // Cornell Note Functions
        function provideCornellFeedback() {
            const cues = document.getElementById('cornellCues')?.value.trim() || '';
            const notes = document.getElementById('cornellNotes')?.value.trim() || '';
            const summary = document.getElementById('cornellSummary')?.value.trim() || '';
            const feedback = document.getElementById('cornellFeedback');
            
            if (!feedback) return;
            
            let feedbackText = '<strong>Feedback:</strong><br>';
            let score = 0;
            
            if (cues.length > 10) {
                feedbackText += '‚úÖ Good cues section - you have questions/keywords<br>';
                score++;
            }

        function backToExplore() {
            hideAllSections();
            document.querySelector('.explore-section').style.display = 'block';
            document.querySelector('.explore-section').classList.add('active');
        } else {
                feedbackText += '‚ùó Try adding more cues/questions in the left column<br>';
            }
            
            if (notes.length > 20) {
                feedbackText += '‚úÖ Good main notes - detailed content captured<br>';
                score++;
            } else {
                feedbackText += '‚ùó Add more detailed notes about the water cycle<br>';
            }
            
            if (summary.length > 15) {
                feedbackText += '‚úÖ Summary provided - great for review<br>';
                score++;
            } else {
                feedbackText += '‚ùó Add a summary of the main points<br>';
            }
            
            if (score === 3) {
                feedbackText += '<br><strong>üéâ Excellent Cornell note structure!</strong>';
            } else {
                feedbackText += '<br><strong>Keep practicing - you\'re getting there!</strong>';
            }
            
            feedback.innerHTML = feedbackText;
            feedback.style.display = 'block';
        }

        function clearCornellDemo() {
            const cues = document.getElementById('cornellCues');
            const notes = document.getElementById('cornellNotes');
            const summary = document.getElementById('cornellSummary');
            const feedback = document.getElementById('cornellFeedback');
            
            if (cues) cues.value = '';
            if (notes) notes.value = '';
            if (summary) summary.value = '';
            if (feedback) feedback.style.display = 'none';
        }

        // Outline Functions
        function checkOutlineStructure() {
            const outline = document.getElementById('outlineNotes')?.value.trim() || '';
            const feedback = document.getElementById('outlineFeedback');
            
            if (!feedback) return;
            
            let feedbackText = '<strong>Structure Check:</strong><br>';
            
            if (outline.includes('I.') || outline.includes('1.')) {
                feedbackText += '‚úÖ Good use of main headings<br>';
            } else {
                feedbackText += '‚ùó Try using Roman numerals (I, II, III) or numbers (1, 2, 3) for main topics<br>';
            }
            
            if (outline.includes('A.') || outline.includes('a.')) {
                feedbackText += '‚úÖ Good subtopic organization<br>';
            } else {
                feedbackText += '‚ùó Use letters (A, B, C) for subtopics under main headings<br>';
            }
            
            if (outline.toLowerCase().includes('solar') && outline.toLowerCase().includes('wind')) {
                feedbackText += '‚úÖ Content covers multiple energy types<br>';
            } else {
                feedbackText += '‚ùó Make sure to cover different renewable energy types<br>';
            }
            
            feedback.innerHTML = feedbackText;
            feedback.style.display = 'block';
        }

        function showOutlineExample() {
            const textarea = document.getElementById('outlineNotes');
            if (!textarea) return;
            
            textarea.value = `I. Solar Energy
    A. Photovoltaic cells
        1. Convert sunlight to electricity
        2. Used in solar panels
    B. Advantages
        1. Renewable resource
        2. No emissions during operation
    C. Disadvantages
        1. High initial costs
        2. Weather dependent

II. Wind Energy
    A. Wind turbines
        1. Convert wind to electricity
        2. Located in windy areas
    B. Advantages
        1. Renewable resource
        2. Cost-effective long term
    C. Disadvantages
        1. Noise pollution
        2. Visual impact

III. Hydroelectric Power
    A. Uses flowing water
    B. Advantages and disadvantages similar to above`;
        }

        function clearOutlineDemo() {
            const outline = document.getElementById('outlineNotes');
            const feedback = document.getElementById('outlineFeedback');
            
            if (outline) outline.value = '';
            if (feedback) feedback.style.display = 'none';
        }

        // Charting Functions
        function checkChartingAnswers() {
            const feedback = document.getElementById('chartingFeedback');
            if (!feedback) return;
            
            let feedbackText = '<strong>Chart Review:</strong><br>';
            
            const cornellBest = document.getElementById('cornell_bestfor')?.value.toLowerCase() || '';
            const outlineBest = document.getElementById('outline_bestfor')?.value.toLowerCase() || '';
            
            if (cornellBest.includes('review') || cornellBest.includes('study') || cornellBest.includes('test')) {
                feedbackText += '‚úÖ Cornell "Best For" - good understanding<br>';
            } else {
                feedbackText += 'üí° Cornell is great for systematic review and test prep<br>';
            }
            
            if (outlineBest.includes('structure') || outlineBest.includes('organize') || outlineBest.includes('logical')) {
                feedbackText += '‚úÖ Outline "Best For" - correct!<br>';
            } else {
                feedbackText += 'üí° Outline works best for structured, logical content<br>';
            }
            
            feedbackText += '<br>Great practice with comparative charts!';
            
            feedback.innerHTML = feedbackText;
            feedback.style.display = 'block';
        }

        function addChartRow() {
            const table = document.getElementById('chartingTable');
            if (!table) return;
            
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" placeholder="Method name..." style="width: 100%; border: none; padding: 2px;"></td>
                <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" placeholder="Best for..." style="width: 100%; border: none; padding: 2px;"></td>
                <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" placeholder="Speed rating..." style="width: 100%; border: none; padding: 2px;"></td>
                <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" placeholder="Organization rating..." style="width: 100%; border: none; padding: 2px;"></td>
            `;
        }

        function clearChartingDemo() {
            const inputs = document.querySelectorAll('#chartingTable input');
            inputs.forEach(input => input.value = '');
            
            const feedback = document.getElementById('chartingFeedback');
            if (feedback) feedback.style.display = 'none';
        }

        // Sentence Method Functions
        function checkSentenceFormat() {
            const notes = document.getElementById('sentenceNotes')?.value.trim() || '';
            const feedback = document.getElementById('sentenceFeedback');
            
            if (!feedback) return;
            
            let feedbackText = '<strong>Format Check:</strong><br>';
            
            const lines = notes.split('\n').filter(line => line.trim().length > 0);
            let numberedLines = 0;
            
            lines.forEach(line => {
                if (/^\d+\./.test(line.trim())) {
                    numberedLines++;
                }
            });
            
            if (numberedLines >= 3) {
                feedbackText += `‚úÖ Good numbering - ${numberedLines} numbered points<br>`;
            } else {
                feedbackText += '‚ùó Try numbering each separate fact (1., 2., 3., etc.)<br>';
            }
            
            if (notes.toLowerCase().includes('1773') || notes.toLowerCase().includes('tea party')) {
                feedbackText += '‚úÖ Capturing key facts and dates<br>';
            } else {
                feedbackText += 'üí° Don\'t forget important dates and events<br>';
            }
            
            if (lines.length >= 5) {
                feedbackText += '‚úÖ Good detail level for sentence method<br>';
            } else {
                feedbackText += 'üí° Try to capture more individual facts<br>';
            }
            
            feedback.innerHTML = feedbackText;
            feedback.style.display = 'block';
        }

        function autoNumber() {
            const textarea = document.getElementById('sentenceNotes');
            if (!textarea) return;
            
            const text = textarea.value.trim();
            
            if (text.length === 0) {
                textarea.value = '1. \n2. \n3. \n4. \n5. ';
                return;
            }
            
            const lines = text.split('\n');
            let numberedText = '';
            let counter = 1;
            
            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (trimmedLine.length > 0) {
                    // Remove existing numbers
                    const cleanLine = trimmedLine.replace(/^\d+\.\s*/, '');
                    if (cleanLine.length > 0) {
                        numberedText += `${counter}. ${cleanLine}\n`;
                        counter++;
                    }
                } else {
                    numberedText += '\n';
                }
            });
            
            textarea.value = numberedText;
        }

        function clearSentenceDemo() {
            const notes = document.getElementById('sentenceNotes');
            const feedback = document.getElementById('sentenceFeedback');
            
            if (notes) notes.value = '';
            if (feedback) feedback.style.display = 'none';
        }

        // Quiz data and state
        function clearSketchCanvas() {
            const canvas = document.getElementById('sketchCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Reset background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function addSketchSymbol(symbol) {
            const canvas = document.getElementById('sketchCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.font = '24px Arial';
            ctx.fillStyle = '#333333';
            
            // Add symbol at a random position
            const x = Math.random() * (canvas.width - 50) + 25;
            const y = Math.random() * (canvas.height - 50) + 25;
            
            ctx.fillText(symbol, x, y);
        }

        function addSketchText() {
            const canvas = document.getElementById('sketchCanvas');
            const textInput = document.getElementById('sketchTextInput');
            if (!canvas || !textInput) return;
            
            const text = textInput.value.trim();
            if (!text) {
                alert('Please enter some text first');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            ctx.font = '16px Arial';
            ctx.fillStyle = '#333333';
            
            // Add text at center-ish position
            const x = canvas.width / 2 - (text.length * 4);
            const y = canvas.height / 2;
            
            ctx.fillText(text, x, y);
            textInput.value = '';
        }

        function downloadSketch() {
            const canvas = document.getElementById('sketchCanvas');
            if (!canvas) return;
            
            // Create download link
            const link = document.createElement('a');
            link.download = 'my-sketchnote.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        function provideSketchingTips() {
            const feedback = document.getElementById('sketchingFeedback');
            if (!feedback) return;
            
            const tips = [
                "üé® Use simple shapes - circles, squares, arrows work great!",
                "‚úèÔ∏è Don't worry about perfect drawing - function over form!",
                "üî§ Mix text sizes - big for main ideas, small for details",
                "üéØ Use arrows to show connections and flow",
                "üì¶ Box important concepts to make them stand out",
                "üåü Add icons and symbols to represent ideas quickly"
            ];
            
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            feedback.innerHTML = `<strong>üí° Sketchnoting Tip:</strong><br>${randomTip}`;
            feedback.style.display = 'block';
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .intro-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .intro-section h2 {
            color: #1f2937;
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .intro-section p {
            color: #6b7280;
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .quiz-section, .results-section, .walkthrough-section, .explore-section {
            display: none;
        }

        .quiz-section.active, .results-section.active, .walkthrough-section.active, .explore-section.active {
            display: block;
        }

        .methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .method-preview {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .method-preview:hover {
            border-color: #4f46e5;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(79, 70, 229, 0.15);
        }

        .method-preview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .method-preview:hover::before {
            opacity: 1;
        }

        .method-icon {
            font-size: 3em;
            margin-bottom: 15px;
            filter: grayscale(20%);
            transition: filter 0.3s ease;
        }

        .method-preview:hover .method-icon {
            filter: grayscale(0%);
        }

        .method-preview h3 {
            color: #1f2937;
            font-size: 1.4em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .method-preview p {
            color: #6b7280;
            line-height: 1.6;
            margin-bottom: 20px;
            min-height: 60px;
        }

        .method-tags {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tag {
            background: #f3f4f6;
            color: #4b5563;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .method-preview:hover .tag {
            background: #eef2ff;
            color: #4f46e5;
        }

        .method-btn {
            width: 100%;
            margin: 0;
            font-size: 1em;
        }

        .question {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid #4f46e5;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .question h3 {
            color: #1f2937;
            font-size: 1.2em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .option:hover {
            border-color: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.15);
        }

        .option.selected {
            border-color: #4f46e5;
            background: #eef2ff;
            transform: translateY(-2px);
        }

        .option::before {
            content: '';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .option.selected::before {
            border-color: #4f46e5;
            background: #4f46e5;
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='m13.854 3.646-6.5 6.5a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7 9.293l6.146-6.147a.5.5 0 0 1 .708.708z'/%3e%3c/svg%3e");
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 10px 0 0;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 20px rgba(107, 114, 128, 0.3);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            transition: width 0.5s ease;
            border-radius: 3px;
        }

        .results-card {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
            text-align: center;
        }

        .results-card h3 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .results-card p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .method-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .method-card:hover {
            border-color: #4f46e5;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .method-card h4 {
            color: #1f2937;
            font-size: 1.4em;
            margin-bottom: 15px;
        }

        .method-card p {
            color: #6b7280;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .walkthrough {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .walkthrough h4 {
            color: #1f2937;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .step {
            background: white;
            border-left: 3px solid #4f46e5;
            padding: 15px 20px;
            margin-bottom: 15px;
            border-radius: 0 8px 8px 0;
        }

        .step-number {
            background: #4f46e5;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
            font-size: 0.9em;
        }

        .visual-example {
            background: #f3f4f6;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: monospace;
            min-height: 150px;
            position: relative;
        }

        .cornell-example {
            display: grid;
            grid-template-columns: 1fr 3fr;
            grid-template-rows: 1fr auto;
            gap: 10px;
            height: 200px;
        }

        .cornell-cues {
            background: #fef3c7;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .cornell-notes {
            background: #dbeafe;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .cornell-summary {
            background: #dcfce7;
            padding: 10px;
            border-radius: 4px;
            grid-column: 1 / -1;
            font-size: 0.9em;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .interactive-demo {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        .demo-input {
            width: 100%;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .demo-output {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 15px;
            min-height: 100px;
            font-family: system-ui;
        }

        .mind-map-node {
            user-select: none;
            transition: transform 0.2s ease;
        }

        .mind-map-node:hover {
            transform: translate(-50%, -50%) scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù Note-Taking Discovery Tool</h1>
            <p>Find the perfect note-taking method for your learning style and academic needs</p>
        </div>

        <div class="content">
            <!-- Introduction Section -->
            <div class="intro-section">
                <h2>Welcome to Better Note-Taking!</h2>
                <p>Research shows that effective note-taking can improve learning outcomes by up to 40%. The key is finding the method that works best for <em>you</em>. This tool will assess your preferences, study habits, and academic needs to recommend the most effective note-taking approach.</p>
                <p><strong>Ready to transform your study sessions?</strong></p>
                <div style="text-align: center;">
                    <button class="btn" onclick="startQuiz()">Take Discovery Quiz</button>
                    <button class="btn btn-secondary" onclick="exploreAllMethods()">Explore All Methods</button>
                </div>

            <!-- Quiz Section -->
                <p style="margin-top: 15px; font-size: 0.9em; color: #6b7280; text-align: center;">
                    Take the quiz for a personalized recommendation, or browse all methods to find what interests you!
                </p>
            </div>

            <!-- Explore Methods Section -->
            <div class="explore-section">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2>Explore All Note-Taking Methods</h2>
                    <p>Discover the strengths of each method and try their interactive walkthroughs.</p>
                </div>

                <div class="methods-grid">
                    <div class="method-preview">
                        <div class="method-icon">üìù</div>
                        <h3>Cornell Method</h3>
                        <p>Structured system with cues, notes, and summary sections. Perfect for systematic learners who want effective review.</p>
                        <div class="method-tags">
                            <span class="tag">Great for Review</span>
                            <span class="tag">Test Prep</span>
                        </div>
                        <button class="btn method-btn" onclick="tryMethod('cornell')">Try Cornell Method</button>
                    </div>

                    <div class="method-preview">
                        <div class="method-icon">üóÇÔ∏è</div>
                        <h3>Outline Method</h3>
                        <p>Hierarchical organization using headings and bullet points. Ideal for structured information and logical thinkers.</p>
                        <div class="method-tags">
                            <span class="tag">Organized</span>
                            <span class="tag">Sequential</span>
                        </div>
                        <button class="btn method-btn" onclick="tryMethod('outline')">Try Outline Method</button>
                    </div>

                    <div class="method-preview">
                        <div class="method-icon">üß†</div>
                        <h3>Mind Mapping</h3>
                        <p>Visual diagrams connecting related concepts from a central topic. Perfect for seeing relationships and big picture thinking.</p>
                        <div class="method-tags">
                            <span class="tag">Visual</span>
                            <span class="tag">Creative</span>
                        </div>
                        <button class="btn method-btn" onclick="tryMethod('mapping')">Try Mind Mapping</button>
                    </div>

                    <div class="method-preview">
                        <div class="method-icon">üìä</div>
                        <h3>Charting Method</h3>
                        <p>Table-based system for organizing information in columns and rows. Excellent for comparing different items or concepts.</p>
                        <div class="method-tags">
                            <span class="tag">Comparative</span>
                            <span class="tag">Organized</span>
                        </div>
                        <button class="btn method-btn" onclick="tryMethod('charting')">Try Charting Method</button>
                    </div>

                    <div class="method-preview">
                        <div class="method-icon">‚úçÔ∏è</div>
                        <h3>Sentence Method</h3>
                        <p>Simple, fast approach writing each new fact as a numbered sentence. Perfect for capturing lots of information quickly.</p>
                        <div class="method-tags">
                            <span class="tag">Fast</span>
                            <span class="tag">Detailed</span>
                        </div>
                        <button class="btn method-btn" onclick="tryMethod('sentence')">Try Sentence Method</button>
                    </div>

                    <div class="method-preview">
                        <div class="method-icon">üé®</div>
                        <h3>Sketchnoting</h3>
                        <p>Visual note-taking combining text with drawings, symbols, and diagrams. Research-proven to enhance memory and engagement.</p>
                        <div class="method-tags">
                            <span class="tag">Visual</span>
                            <span class="tag">Memory Boost</span>
                        </div>
                        <button class="btn method-btn" onclick="tryMethod('sketchnoting')">Try Sketchnoting</button>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="backToIntro()">Back to Home</button>
                    <button class="btn" onclick="startQuiz()">Take Personalized Quiz</button>
                </div>
            </div>
            <div class="quiz-section">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                
                <div id="quizContainer">
                    <!-- Questions will be inserted here -->
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="previousQuestion()" id="prevBtn" style="display: none;">Previous</button>
                    <button class="btn" onclick="nextQuestion()" id="nextBtn" disabled>Next Question</button>
                    <button class="btn" onclick="finishQuiz()" id="finishBtn" style="display: none;">Get My Results</button>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section">
                <div class="results-card">
                    <h3 id="recommendedMethod">Your Recommended Method</h3>
                    <p id="methodDescription">Perfect for your learning style!</p>
                </div>

                <div id="methodDetails">
                    <!-- Method details will be inserted here -->
                </div>

                <div style="text-align: center;">
                    <button class="btn" onclick="startWalkthrough()">Try Interactive Walkthrough</button>
                    <button class="btn btn-secondary" onclick="retakeQuiz()">Retake Quiz</button>
                </div>
            </div>

            <!-- Walkthrough Section -->
            <div class="walkthrough-section">
                <div class="walkthrough">
                    <h4 id="walkthroughTitle">Interactive Walkthrough</h4>
                    <div id="walkthroughContent">
                        <!-- Walkthrough content will be inserted here -->
                    </div>
                </div>

                <div style="text-align: center;">
                    <button class="btn btn-secondary" onclick="backToExplore()">Back to Methods</button>
                    <button class="btn btn-secondary" onclick="backToIntro()">Home</button>
                    <button class="btn" onclick="startQuiz()">Take Personalized Quiz</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Navigation and utility functions - defined first for immediate access
        function hideAllSections() {
            const sections = ['.intro-section', '.quiz-section', '.results-section', '.walkthrough-section', '.explore-section'];
            sections.forEach(section => {
                const element = document.querySelector(section);
                if (element) {
                    element.style.display = 'none';
                    element.classList.remove('active');
                }
            });
        }

        function backToExplore() {
            hideAllSections();
            document.querySelector('.explore-section').style.display = 'block';
            document.querySelector('.explore-section').classList.add('active');
        }

        function backToIntro() {
            hideAllSections();
            document.querySelector('.intro-section').style.display = 'block';
        }

        function exploreAllMethods() {
            hideAllSections();
            document.querySelector('.explore-section').style.display = 'block';
            document.querySelector('.explore-section').classList.add('active');
        }

        // Interactive functions for walkthroughs - ALL must be global for onclick access

        // Sketchnoting Functions
        function provideSketchingTips() {
            const feedback = document.getElementById('sketchingFeedback');
            if (!feedback) return;
            
            const tips = [
                "üé® Use simple shapes - circles, squares, arrows work great!",
                "‚úèÔ∏è Don't worry about perfect drawing - function over form!",
                "üî§ Mix text sizes - big for main ideas, small for details",
                "üéØ Use arrows to show connections and flow",
                "üì¶ Box important concepts to make them stand out",
                "üåü Add icons and symbols to represent ideas quickly"
            ];
            
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            feedback.innerHTML = `<strong>üí° Sketchnoting Tip:</strong><br>${randomTip}`;
            feedback.style.display = 'block';
        }

        function clearSketchCanvas() {
            const canvas = document.getElementById('sketchCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Reset background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function addSketchSymbol(symbol) {
            const canvas = document.getElementById('sketchCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.font = '24px Arial';
            ctx.fillStyle = '#333333';
            
            // Add symbol at a random position
            const x = Math.random() * (canvas.width - 50) + 25;
            const y = Math.random() * (canvas.height - 50) + 25;
            
            ctx.fillText(symbol, x, y);
        }

        function addSketchText() {
            const canvas = document.getElementById('sketchCanvas');
            const textInput = document.getElementById('sketchTextInput');
            if (!canvas || !textInput) return;
            
            const text = textInput.value.trim();
            if (!text) {
                alert('Please enter some text first');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            ctx.font = '16px Arial';
            ctx.fillStyle = '#333333';
            
            // Add text at center-ish position
            const x = canvas.width / 2 - (text.length * 4);
            const y = canvas.height / 2;
            
            ctx.fillText(text, x, y);
            textInput.value = '';
        }

        function downloadSketch() {
            const canvas = document.getElementById('sketchCanvas');
            if (!canvas) return;
            
            // Create download link
            const link = document.createElement('a');
            link.download = 'my-sketchnote.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        // Cornell Note Functions
        function provideCornellFeedback() {
            const cues = document.getElementById('cornellCues')?.value.trim() || '';
            const notes = document.getElementById('cornellNotes')?.value.trim() || '';
            const summary = document.getElementById('cornellSummary')?.value.trim() || '';
            const feedback = document.getElementById('cornellFeedback');
            
            if (!feedback) return;
            
            let feedbackText = '<strong>Feedback:</strong><br>';
            let score = 0;
            
            if (cues.length > 10) {
                feedbackText += '‚úÖ Good cues section - you have questions/keywords<br>';
                score++;
            } else {
                feedbackText += '‚ùó Try adding more cues/questions in the left column<br>';
            }
            
            if (notes.length > 20) {
                feedbackText += '‚úÖ Good main notes - detailed content captured<br>';
                score++;
            } else {
                feedbackText += '‚ùó Add more detailed notes about the water cycle<br>';
            }
            
            if (summary.length > 15) {
                feedbackText += '‚úÖ Summary provided - great for review<br>';
                score++;
            } else {
                feedbackText += '‚ùó Add a summary of the main points<br>';
            }
            
            if (score === 3) {
                feedbackText += '<br><strong>üéâ Excellent Cornell note structure!</strong>';
            } else {
                feedbackText += '<br><strong>Keep practicing - you\'re getting there!</strong>';
            }
            
            feedback.innerHTML = feedbackText;
            feedback.style.display = 'block';
        }

        function clearCornellDemo() {
            const cues = document.getElementById('cornellCues');
            const notes = document.getElementById('cornellNotes');
            const summary = document.getElementById('cornellSummary');
            const feedback = document.getElementById('cornellFeedback');
            
            if (cues) cues.value = '';
            if (notes) notes.value = '';
            if (summary) summary.value = '';
            if (feedback) feedback.style.display = 'none';
        }

        // Outline Functions
        function checkOutlineStructure() {
            const outline = document.getElementById('outlineNotes')?.value.trim() || '';
            const feedback = document.getElementById('outlineFeedback');
            
            if (!feedback) return;
            
            let feedbackText = '<strong>Structure Check:</strong><br>';
            
            if (outline.includes('I.') || outline.includes('1.')) {
                feedbackText += '‚úÖ Good use of main headings<br>';
            } else {
                feedbackText += '‚ùó Try using Roman numerals (I, II, III) or numbers (1, 2, 3) for main topics<br>';
            }
            
            if (outline.includes('A.') || outline.includes('a.')) {
                feedbackText += '‚úÖ Good subtopic organization<br>';
            } else {
                feedbackText += '‚ùó Use letters (A, B, C) for subtopics under main headings<br>';
            }
            
            if (outline.toLowerCase().includes('solar') && outline.toLowerCase().includes('wind')) {
                feedbackText += '‚úÖ Content covers multiple energy types<br>';
            } else {
                feedbackText += '‚ùó Make sure to cover different renewable energy types<br>';
            }
            
            feedback.innerHTML = feedbackText;
            feedback.style.display = 'block';
        }

        function showOutlineExample() {
            const textarea = document.getElementById('outlineNotes');
            if (!textarea) return;
            
            textarea.value = `I. Solar Energy
    A. Photovoltaic cells
        1. Convert sunlight to electricity
        2. Used in solar panels
    B. Advantages
        1. Renewable resource
        2. No emissions during operation
    C. Disadvantages
        1. High initial costs
        2. Weather dependent

II. Wind Energy
    A. Wind turbines
        1. Convert wind to electricity
        2. Located in windy areas
    B. Advantages
        1. Renewable resource
        2. Cost-effective long term
    C. Disadvantages
        1. Noise pollution
        2. Visual impact

III. Hydroelectric Power
    A. Uses flowing water
    B. Advantages and disadvantages similar to above`;
        }

        function clearOutlineDemo() {
            const outline = document.getElementById('outlineNotes');
            const feedback = document.getElementById('outlineFeedback');
            
            if (outline) outline.value = '';
            if (feedback) feedback.style.display = 'none';
        }

        // Charting Functions
        function checkChartingAnswers() {
            const feedback = document.getElementById('chartingFeedback');
            if (!feedback) return;
            
            let feedbackText = '<strong>Chart Review:</strong><br>';
            
            const cornellBest = document.getElementById('cornell_bestfor')?.value.toLowerCase() || '';
            const outlineBest = document.getElementById('outline_bestfor')?.value.toLowerCase() || '';
            
            if (cornellBest.includes('review') || cornellBest.includes('study') || cornellBest.includes('test')) {
                feedbackText += '‚úÖ Cornell "Best For" - good understanding<br>';
            } else {
                feedbackText += 'üí° Cornell is great for systematic review and test prep<br>';
            }
            
            if (outlineBest.includes('structure') || outlineBest.includes('organize') || outlineBest.includes('logical')) {
                feedbackText += '‚úÖ Outline "Best For" - correct!<br>';
            } else {
                feedbackText += 'üí° Outline works best for structured, logical content<br>';
            }
            
            feedbackText += '<br>Great practice with comparative charts!';
            
            feedback.innerHTML = feedbackText;
            feedback.style.display = 'block';
        }

        function addChartRow() {
            const table = document.getElementById('chartingTable');
            if (!table) return;
            
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" placeholder="Method name..." style="width: 100%; border: none; padding: 2px;"></td>
                <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" placeholder="Best for..." style="width: 100%; border: none; padding: 2px;"></td>
                <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" placeholder="Speed rating..." style="width: 100%; border: none; padding: 2px;"></td>
                <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" placeholder="Organization rating..." style="width: 100%; border: none; padding: 2px;"></td>
            `;
        }

        function clearChartingDemo() {
            const inputs = document.querySelectorAll('#chartingTable input');
            inputs.forEach(input => input.value = '');
            
            const feedback = document.getElementById('chartingFeedback');
            if (feedback) feedback.style.display = 'none';
        }

        // Sentence Method Functions
        function checkSentenceFormat() {
            const notes = document.getElementById('sentenceNotes')?.value.trim() || '';
            const feedback = document.getElementById('sentenceFeedback');
            
            if (!feedback) return;
            
            let feedbackText = '<strong>Format Check:</strong><br>';
            
            const lines = notes.split('\n').filter(line => line.trim().length > 0);
            let numberedLines = 0;
            
            lines.forEach(line => {
                if (/^\d+\./.test(line.trim())) {
                    numberedLines++;
                }
            });
            
            if (numberedLines >= 3) {
                feedbackText += `‚úÖ Good numbering - ${numberedLines} numbered points<br>`;
            } else {
                feedbackText += '‚ùó Try numbering each separate fact (1., 2., 3., etc.)<br>';
            }
            
            if (notes.toLowerCase().includes('1773') || notes.toLowerCase().includes('tea party')) {
                feedbackText += '‚úÖ Capturing key facts and dates<br>';
            } else {
                feedbackText += 'üí° Don\'t forget important dates and events<br>';
            }
            
            if (lines.length >= 5) {
                feedbackText += '‚úÖ Good detail level for sentence method<br>';
            } else {
                feedbackText += 'üí° Try to capture more individual facts<br>';
            }
            
            feedback.innerHTML = feedbackText;
            feedback.style.display = 'block';
        }

        function autoNumber() {
            const textarea = document.getElementById('sentenceNotes');
            if (!textarea) return;
            
            const text = textarea.value.trim();
            
            if (text.length === 0) {
                textarea.value = '1. \n2. \n3. \n4. \n5. ';
                return;
            }
            
            const lines = text.split('\n');
            let numberedText = '';
            let counter = 1;
            
            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (trimmedLine.length > 0) {
                    // Remove existing numbers
                    const cleanLine = trimmedLine.replace(/^\d+\.\s*/, '');
                    if (cleanLine.length > 0) {
                        numberedText += `${counter}. ${cleanLine}\n`;
                        counter++;
                    }
                } else {
                    numberedText += '\n';
                }
            });
            
            textarea.value = numberedText;
        }

        function clearSentenceDemo() {
            const notes = document.getElementById('sentenceNotes');
            const feedback = document.getElementById('sentenceFeedback');
            
            if (notes) notes.value = '';
            if (feedback) feedback.style.display = 'none';
        }

        // Quiz data and state
        let currentQuestion = 0;
        let answers = {};
        let recommendedMethod = '';

        const questions = [
            {
                id: 'memory_style',
                question: "How do you best remember information?",
                options: [
                    { text: "By seeing visual connections and patterns", value: 'visual' },
                    { text: "By organizing information in structured lists", value: 'structured' },
                    { text: "By writing things down in my own words", value: 'written' },
                    { text: "By creating mental associations and stories", value: 'conceptual' }
                ]
            },
            {
                id: 'info_type',
                question: "What type of information do you take notes on most often?",
                options: [
                    { text: "Complex concepts with many relationships", value: 'complex' },
                    { text: "Step-by-step processes and procedures", value: 'sequential' },
                    { text: "Facts, dates, and definitions", value: 'facts' },
                    { text: "Comparing different ideas or systems", value: 'comparative' }
                ]
            },
            {
                id: 'time_pressure',
                question: "How much time do you typically have during lectures?",
                options: [
                    { text: "Plenty of time to write detailed notes", value: 'detailed' },
                    { text: "Need to capture information quickly", value: 'fast' },
                    { text: "Moderate pace with some time to organize", value: 'moderate' },
                    { text: "Varies greatly depending on the class", value: 'flexible' }
                ]
            },
            {
                id: 'review_style',
                question: "How do you prefer to review your notes?",
                options: [
                    { text: "Scan quickly for key points", value: 'scan' },
                    { text: "Read through everything systematically", value: 'systematic' },
                    { text: "Test myself with questions", value: 'testing' },
                    { text: "Look for patterns and connections", value: 'patterns' }
                ]
            },
            {
                id: 'visual_preference',
                question: "Which appeals to you most?",
                options: [
                    { text: "Colorful diagrams and mind maps", value: 'visual' },
                    { text: "Clean, organized outlines", value: 'outline' },
                    { text: "Detailed written explanations", value: 'written' },
                    { text: "Charts and comparison tables", value: 'charts' }
                ]
            },
            {
                id: 'creative_expression',
                question: "When explaining ideas to others, you prefer to:",
                options: [
                    { text: "Draw diagrams and sketch concepts", value: 'visual_creative' },
                    { text: "Use clear logical explanations", value: 'logical' },
                    { text: "Tell stories and use examples", value: 'narrative' },
                    { text: "Present organized facts and data", value: 'factual' }
                ]
            },
            {
                id: 'challenge',
                question: "What's your biggest note-taking challenge?",
                options: [
                    { text: "Keeping up with fast-paced lectures", value: 'speed' },
                    { text: "Organizing information logically", value: 'organization' },
                    { text: "Remembering what I wrote later", value: 'memory' },
                    { text: "Staying engaged with boring content", value: 'engagement' }
                ]
            },
            {
                id: 'digital_comfort',
                question: "How comfortable are you with digital tools?",
                options: [
                    { text: "Very comfortable - I prefer digital", value: 'digital' },
                    { text: "Comfortable but prefer paper sometimes", value: 'mixed' },
                    { text: "Prefer paper but open to digital", value: 'paper_open' },
                    { text: "Strongly prefer handwritten notes", value: 'paper' }
                ]
            }
        ];

        const noteMethods = {
            cornell: {
                name: "Cornell Note-Taking Method",
                description: "A structured system perfect for systematic learners who like to review effectively",
                details: "The Cornell Method divides your page into three sections: notes, cues, and summary. This method encourages active learning and makes review sessions highly effective.",
                pros: ["Great for systematic review", "Encourages active thinking", "Perfect for test preparation", "Works well for most subjects"],
                cons: ["Takes more initial setup", "May feel restrictive for creative subjects"],
                bestFor: "Students who like structure and need effective review systems"
            },
            outline: {
                name: "Outline Method",
                description: "Hierarchical organization perfect for structured information and logical thinkers",
                details: "The Outline Method uses headings, subheadings, and bullet points to create a clear hierarchy of information. It's excellent for organized lectures and textbook reading.",
                pros: ["Clear information hierarchy", "Easy to follow lecture structure", "Great for organizing complex topics", "Simple to use"],
                cons: ["Can be difficult with unstructured content", "May miss connections between topics"],
                bestFor: "Logical, sequential content and students who prefer clear organization"
            },
            mapping: {
                name: "Mind Mapping Method",
                description: "Visual approach perfect for connecting ideas and seeing the big picture",
                details: "Mind Mapping uses visual diagrams to connect related concepts, starting from a central topic and branching outward. Perfect for visual learners and complex subjects.",
                pros: ["Shows relationships clearly", "Great for visual learners", "Encourages creative thinking", "Excellent for brainstorming"],
                cons: ["Can become messy", "Takes practice to master", "May not work for linear information"],
                bestFor: "Complex concepts with many relationships and visual learners"
            },
            charting: {
                name: "Charting Method",
                description: "Table-based system perfect for comparing information and factual content",
                details: "The Charting Method organizes information in columns and rows, making it perfect for comparing different items, concepts, or time periods.",
                pros: ["Excellent for comparisons", "Clear organization of facts", "Easy to scan and review", "Great for systematic subjects"],
                cons: ["Limited to certain types of information", "Can be rigid for creative content"],
                bestFor: "Comparative information, scientific data, and fact-heavy subjects"
            },
            sentence: {
                name: "Sentence Method",
                description: "Simple, fast approach perfect for capturing everything quickly",
                details: "The Sentence Method involves writing each new piece of information as a separate numbered sentence. It's perfect for fast-paced lectures where you need to capture everything.",
                pros: ["Very fast", "Captures lots of detail", "Simple to use", "Good for unpredictable lectures"],
                cons: ["Can be overwhelming to review", "Lacks clear organization", "Hard to identify key points"],
                bestFor: "Fast-paced lectures and when you need to capture maximum information"
            },
            sketchnoting: {
                name: "Sketchnoting Method",
                description: "Visual note-taking combining text, drawings, symbols, and diagrams for enhanced memory",
                details: "Sketchnoting combines traditional text notes with visual elements like drawings, icons, arrows, and layouts. Research shows that adding visual elements significantly improves memory and understanding.",
                pros: ["Enhances memory retention", "Makes boring content engaging", "Develops visual thinking", "Great for presentations"],
                cons: ["Takes practice to develop", "May be slower initially", "Not ideal for pure text lectures"],
                bestFor: "Visual learners, creative subjects, and anyone wanting to improve memory retention"
            }
        };

        function startQuiz() {
            // Hide all sections first
            hideAllSections();
            
            // Show and activate quiz section
            document.querySelector('.quiz-section').style.display = 'block';
            document.querySelector('.quiz-section').classList.add('active');
            
            // Reset quiz state
            currentQuestion = 0;
            answers = {};
            recommendedMethod = '';
            
            // Clear any mind map state if it exists
            if (typeof mindMapNodes !== 'undefined') {
                mindMapNodes = [];
                nodeCounter = 0;
            }
            
            displayQuestion();
        }

        function tryMethod(methodName) {
            // Set the recommended method and go directly to walkthrough
            recommendedMethod = methodName;
            hideAllSections();
            document.querySelector('.walkthrough-section').style.display = 'block';
            document.querySelector('.walkthrough-section').classList.add('active');

            // Debug: Check if function exists
            console.log('Trying method:', methodName);
            console.log('createSketchnotingWalkthrough exists:', typeof createSketchnotingWalkthrough);

            const walkthroughs = {
                cornell: createCornellWalkthrough,
                outline: createOutlineWalkthrough,
                mapping: createMappingWalkthrough,
                charting: createChartingWalkthrough,
                sentence: createSentenceWalkthrough,
                sketchnoting: createSketchnotingWalkthrough
            };

            console.log('Walkthroughs object:', walkthroughs);
            console.log('Selected function:', walkthroughs[methodName]);

            const titleElement = document.getElementById('walkthroughTitle');
            const contentElement = document.getElementById('walkthroughContent');
            
            if (titleElement) {
                titleElement.textContent = `${noteMethods[methodName].name} - Interactive Practice`;
            }
            
            if (contentElement && walkthroughs[methodName]) {
                contentElement.innerHTML = walkthroughs[methodName]();
            } else {
                console.error('Missing walkthrough function for:', methodName);
            }

            // Set up mind map interactivity if this is the mapping method
            if (methodName === 'mapping') {
                setTimeout(setupMindMapInteractivity, 500); // Increased timeout
            }

            // Set up sketchnoting canvas if this is the sketchnoting method
            if (methodName === 'sketchnoting') {
                setTimeout(setupSketchingCanvas, 500); // Increased timeout
            }
        }

        function displayQuestion() {
            const container = document.getElementById('quizContainer');
            const question = questions[currentQuestion];
            
            container.innerHTML = `
                <div class="question fade-in">
                    <h3>Question ${currentQuestion + 1} of ${questions.length}</h3>
                    <h3>${question.question}</h3>
                    <div class="options">
                        ${question.options.map((option, index) => `
                            <div class="option" onclick="selectOption('${question.id}', '${option.value}', this)">
                                ${option.text}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            // If there's a previous answer for this question, select it
            if (answers[question.id]) {
                const selectedOption = container.querySelector(`[onclick*="'${answers[question.id]}'"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
            }

            updateProgress();
            updateButtons();
        }

        function selectOption(questionId, value, element) {
            // Remove previous selection
            element.parentNode.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            // Add selection to clicked option
            element.classList.add('selected');
            
            answers[questionId] = value;
            document.getElementById('nextBtn').disabled = false;
            
            // Update button states (especially important for the last question)
            updateButtons();
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                displayQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                displayQuestion();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function updateButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const finishBtn = document.getElementById('finishBtn');

            // Safely check if buttons exist before updating them
            if (!prevBtn || !nextBtn || !finishBtn) return;

            prevBtn.style.display = currentQuestion > 0 ? 'inline-block' : 'none';
            
            if (currentQuestion === questions.length - 1) {
                nextBtn.style.display = 'none';
                finishBtn.style.display = 'inline-block';
                finishBtn.disabled = !answers[questions[currentQuestion].id];
            } else {
                nextBtn.style.display = 'inline-block';
                finishBtn.style.display = 'none';
                nextBtn.disabled = !answers[questions[currentQuestion].id];
            }
        }

        function calculateRecommendation() {
            const scores = {
                cornell: 0,
                outline: 0,
                mapping: 0,
                charting: 0,
                sentence: 0,
                sketchnoting: 0
            };

            // Scoring logic based on answers
            if (answers.memory_style === 'structured') scores.cornell += 2, scores.outline += 2;
            if (answers.memory_style === 'visual') scores.mapping += 3, scores.sketchnoting += 2;
            if (answers.memory_style === 'written') scores.cornell += 1, scores.sentence += 1;
            if (answers.memory_style === 'conceptual') scores.mapping += 2, scores.sketchnoting += 3;

            if (answers.info_type === 'complex') scores.mapping += 3, scores.sketchnoting += 2;
            if (answers.info_type === 'sequential') scores.outline += 3;
            if (answers.info_type === 'facts') scores.charting += 2, scores.cornell += 1;
            if (answers.info_type === 'comparative') scores.charting += 3;

            if (answers.time_pressure === 'fast') scores.sentence += 3;
            if (answers.time_pressure === 'detailed') scores.cornell += 2, scores.mapping += 1, scores.sketchnoting += 2;
            if (answers.time_pressure === 'moderate') scores.outline += 2, scores.sketchnoting += 1;

            if (answers.review_style === 'scan') scores.outline += 2, scores.charting += 1;
            if (answers.review_style === 'systematic') scores.cornell += 3;
            if (answers.review_style === 'testing') scores.cornell += 2;
            if (answers.review_style === 'patterns') scores.mapping += 3, scores.sketchnoting += 2;

            if (answers.visual_preference === 'visual') scores.mapping += 3, scores.sketchnoting += 3;
            if (answers.visual_preference === 'outline') scores.outline += 3;
            if (answers.visual_preference === 'written') scores.sentence += 2, scores.cornell += 1;
            if (answers.visual_preference === 'charts') scores.charting += 3;

            if (answers.creative_expression === 'visual_creative') scores.sketchnoting += 4;
            if (answers.creative_expression === 'logical') scores.outline += 2, scores.cornell += 1;
            if (answers.creative_expression === 'narrative') scores.mapping += 2, scores.sketchnoting += 1;
            if (answers.creative_expression === 'factual') scores.charting += 2, scores.sentence += 1;

            if (answers.challenge === 'speed') scores.sentence += 2;
            if (answers.challenge === 'organization') scores.cornell += 2, scores.outline += 2;
            if (answers.challenge === 'memory') scores.cornell += 3, scores.sketchnoting += 3;
            if (answers.challenge === 'engagement') scores.sketchnoting += 4;

            if (answers.digital_comfort === 'digital') scores.sketchnoting += 1;
            if (answers.digital_comfort === 'paper') scores.sketchnoting += 2; // Hand-drawn sketches

            // Find highest scoring method
            return Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
        }

        function finishQuiz() {
            recommendedMethod = calculateRecommendation();
            showResults();
        }

        function showResults() {
            document.querySelector('.quiz-section').style.display = 'none';
            document.querySelector('.quiz-section').classList.remove('active');
            document.querySelector('.results-section').style.display = 'block';
            document.querySelector('.results-section').classList.add('active');

            const method = noteMethods[recommendedMethod];
            
            const titleElement = document.getElementById('recommendedMethod');
            const descElement = document.getElementById('methodDescription');
            const detailsElement = document.getElementById('methodDetails');
            
            if (titleElement) titleElement.textContent = method.name;
            if (descElement) descElement.textContent = method.description;

            if (detailsElement) {
                detailsElement.innerHTML = `
                    <div class="method-card fade-in">
                        <h4>Why this method works for you:</h4>
                        <p>${method.details}</p>
                        
                        <h4>Advantages:</h4>
                        <ul style="margin-left: 20px; color: #10b981;">
                            ${method.pros.map(pro => `<li style="margin-bottom: 5px;">${pro}</li>`).join('')}
                        </ul>
                        
                        <h4>Considerations:</h4>
                        <ul style="margin-left: 20px; color: #f59e0b;">
                            ${method.cons.map(con => `<li style="margin-bottom: 5px;">${con}</li>`).join('')}
                        </ul>
                        
                        <p style="margin-top: 15px;"><strong>Best for:</strong> ${method.bestFor}</p>
                    </div>
                `;
            }
        }

        function startWalkthrough() {
            document.querySelector('.results-section').style.display = 'none';
            document.querySelector('.results-section').classList.remove('active');
            document.querySelector('.walkthrough-section').style.display = 'block';
            document.querySelector('.walkthrough-section').classList.add('active');

            const walkthroughs = {
                cornell: createCornellWalkthrough,
                outline: createOutlineWalkthrough,
                mapping: createMappingWalkthrough,
                charting: createChartingWalkthrough,
                sentence: createSentenceWalkthrough
            };

            document.getElementById('walkthroughTitle').textContent = `${noteMethods[recommendedMethod].name} - Interactive Practice`;
            document.getElementById('walkthroughContent').innerHTML = walkthroughs[recommendedMethod]();

            // Set up mind map interactivity if this is the mapping method
            if (recommendedMethod === 'mapping') {
                setTimeout(setupMindMapInteractivity, 100); // Small delay to ensure DOM is ready
            }
        }

        function setupMindMapInteractivity() {
            const canvas = document.getElementById('mindMapCanvas');
            const newNodeInput = document.getElementById('newNodeText');
            
            if (canvas) {
                // Canvas click to add nodes
                canvas.addEventListener('click', function(e) {
                    // Only add node if clicking on the canvas itself, not on existing nodes
                    if (e.target === canvas) {
                        const rect = canvas.getBoundingClientRect();
                        const x = ((e.clientX - rect.left) / rect.width) * 100;
                        const y = ((e.clientY - rect.top) / rect.height) * 100;
                        
                        const text = prompt('Enter text for the new node:');
                        if (text && text.trim()) {
                            addMindMapNode(text.trim(), x, y, null);
                        }
                    }
                });

                // Prevent context menu on canvas itself
                canvas.addEventListener('contextmenu', function(e) {
                    if (e.target === canvas) {
                        e.preventDefault();
                    }
                });
            }

            if (newNodeInput) {
                newNodeInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addMindMapNode();
                    }
                });
            }

            // Set up context menu for the central topic
            const centralTopic = document.getElementById('centralTopic');
            if (centralTopic) {
                centralTopic.addEventListener('contextmenu', showNodeContextMenu);
                // Give the central topic a node ID
                centralTopic.dataset.nodeId = '0';
                // Add to mindMapNodes array
                if (!mindMapNodes.find(n => n.id === 0)) {
                    mindMapNodes.push({
                        id: 0,
                        element: centralTopic,
                        text: 'Climate Change',
                        parentId: null,
                        children: []
                    });
                }
            }
        }

        function createCornellWalkthrough() {
            return `
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Set up your page:</strong> Draw a vertical line 2.5 inches from the left margin, and a horizontal line 2 inches from the bottom.
                </div>
                
                <div class="visual-example cornell-example">
                    <div class="cornell-cues">
                        <strong>Cues/Questions</strong><br>
                        ‚Ä¢ Key terms<br>
                        ‚Ä¢ Questions<br>
                        ‚Ä¢ Review prompts
                    </div>
                    <div class="cornell-notes">
                        <strong>Main Notes</strong><br>
                        ‚Ä¢ Lecture content<br>
                        ‚Ä¢ Important details<br>
                        ‚Ä¢ Examples<br>
                        ‚Ä¢ Diagrams
                    </div>
                    <div class="cornell-summary">
                        <strong>Summary Section</strong><br>
                        Main points and key takeaways from the lesson
                    </div>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>During class:</strong> Take notes only in the large right section. Focus on main ideas, key concepts, and supporting details.
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>After class:</strong> Review your notes and write questions, keywords, or cues in the left margin.
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Summarize:</strong> Write a brief summary of the main points in the bottom section.
                </div>

                <div class="interactive-demo">
                    <h4>Try it yourself:</h4>
                    <p>Practice taking Cornell notes on this sample lecture content:</p>
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <strong>Sample Lecture:</strong> "The water cycle consists of evaporation, condensation, precipitation, and collection. Evaporation occurs when the sun heats water in oceans, lakes, and rivers, turning it into water vapor. This vapor rises into the atmosphere where it cools and condenses into clouds..."
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 3fr; gap: 10px; margin: 15px 0;">
                        <textarea id="cornellCues" class="demo-input" placeholder="Write cues/questions here..." rows="4"></textarea>
                        <textarea id="cornellNotes" class="demo-input" placeholder="Take your main notes here..." rows="4"></textarea>
                    </div>
                    <textarea id="cornellSummary" class="demo-input" placeholder="Write your summary here..." rows="2"></textarea>
                    <div style="margin-top: 10px;">
                        <button onclick="provideCornellFeedback()" class="btn" style="font-size: 0.9em; padding: 8px 15px;">Get Feedback</button>
                        <button onclick="clearCornellDemo()" class="btn btn-secondary" style="font-size: 0.9em; padding: 8px 15px;">Clear</button>
                    </div>
                    <div id="cornellFeedback" style="margin-top: 10px; padding: 10px; background: #f0f9ff; border-radius: 6px; display: none;"></div>
                </div>
            `;
        }

        function createOutlineWalkthrough() {
            return `
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Start with main topics:</strong> Write major headings using Roman numerals (I, II, III) or numbers (1, 2, 3).
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Add subtopics:</strong> Use capital letters (A, B, C) for main subtopics under each heading.
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Include details:</strong> Use numbers (1, 2, 3) for supporting details and examples.
                </div>

                <div class="visual-example">
                    <strong>Example Outline Structure:</strong><br><br>
                    I. Main Topic<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;A. Subtopic<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Supporting detail<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. Example<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;B. Another subtopic<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Detail<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. Detail<br>
                    II. Second Main Topic<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;A. Subtopic...
                </div>

                <div class="interactive-demo">
                    <h4>Practice outlining:</h4>
                    <p>Create an outline for this topic: "Types of Renewable Energy"</p>
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <strong>Content:</strong> Solar energy uses photovoltaic cells to convert sunlight. Wind energy uses turbines. Hydroelectric power uses flowing water. Each has advantages like being renewable and disadvantages like initial costs.
                    </div>
                    <textarea id="outlineNotes" class="demo-input" placeholder="Create your outline here..." rows="8"></textarea>
                    <div style="margin-top: 10px;">
                        <button onclick="checkOutlineStructure()" class="btn" style="font-size: 0.9em; padding: 8px 15px;">Check Structure</button>
                        <button onclick="showOutlineExample()" class="btn btn-secondary" style="font-size: 0.9em; padding: 8px 15px;">Show Example</button>
                        <button onclick="clearOutlineDemo()" class="btn btn-secondary" style="font-size: 0.9em; padding: 8px 15px;">Clear</button>
                    </div>
                    <div id="outlineFeedback" style="margin-top: 10px; padding: 10px; background: #f0f9ff; border-radius: 6px; display: none;"></div>
                </div>
            `;
        }

        function createMappingWalkthrough() {
            return `
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Central topic:</strong> Start with the main topic in the center of your page and circle it.
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Main branches:</strong> Add major subtopics around the center. Use the input box or click on the canvas.
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Sub-branches:</strong> Right-click any node to add sub-topics. Create hierarchical connections between related ideas.
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Organize visually:</strong> Drag nodes to arrange them logically. Use colors and visual flow to show relationships.
                </div>

                <div class="visual-example">
                    <div style="text-align: center; padding: 20px;">
                        <div style="display: inline-block; background: #dbeafe; padding: 10px; border-radius: 50%; margin: 10px;">
                            <strong>MAIN TOPIC</strong>
                        </div>
                        <div style="margin: 20px 0;">
                            <div style="display: inline-block; margin: 0 30px;">
                                ‚Üó <span style="background: #fef3c7; padding: 5px; border-radius: 15px; font-weight: bold;">Main Branch A</span><br>
                                &nbsp;&nbsp;&nbsp;&nbsp;‚Üí <span style="background: #f3f4f6; padding: 3px 8px; border-radius: 10px; font-size: 0.9em;">Sub-topic 1</span><br>
                                &nbsp;&nbsp;&nbsp;&nbsp;‚Üí <span style="background: #f3f4f6; padding: 3px 8px; border-radius: 10px; font-size: 0.9em;">Sub-topic 2</span>
                            </div>
                            <div style="display: inline-block; margin: 0 30px;">
                                ‚Üñ <span style="background: #dcfce7; padding: 5px; border-radius: 15px; font-weight: bold;">Main Branch B</span><br>
                                &nbsp;&nbsp;&nbsp;&nbsp;‚Üí <span style="background: #f3f4f6; padding: 3px 8px; border-radius: 10px; font-size: 0.9em;">Detail 1</span><br>
                                &nbsp;&nbsp;&nbsp;&nbsp;‚Üí <span style="background: #f3f4f6; padding: 3px 8px; border-radius: 10px; font-size: 0.9em;">Detail 2</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="interactive-demo">
                    <h4>Create your hierarchical mind map about "Climate Change":</h4>
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <strong>Instructions:</strong><br>
                        <strong>üìù Add Main Topics:</strong> Type "Causes", "Effects", "Solutions" and click "Add Node"<br>
                        <strong>üñ±Ô∏è Click to Place:</strong> Click anywhere on canvas to add a node at that spot<br>
                        <strong>üñ±Ô∏è Right-Click for Sub-nodes:</strong> Right-click any node ‚Üí "Add Sub-Node" for hierarchical structure<br>
                        <strong>‚úã Drag to Organize:</strong> Click and drag nodes to arrange them visually<br>
                        <strong>‚ùå Delete Nodes:</strong> Right-click ‚Üí "Delete Node" (this also removes all sub-nodes)
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <input type="text" id="newNodeText" placeholder="Type a main topic (e.g., 'Causes', 'Effects', 'Solutions')" style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; margin-right: 10px; width: 300px;">
                        <button onclick="addMindMapNode()" style="padding: 8px 15px; background: #4f46e5; color: white; border: none; border-radius: 4px; cursor: pointer;">Add Node</button>
                        <button onclick="clearMindMap()" style="padding: 8px 15px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">Clear All</button>
                    </div>

                    <div id="mindMapCanvas" style="border: 2px dashed #d1d5db; border-radius: 8px; height: 350px; background: white; position: relative; cursor: crosshair;">
                        <div id="centralTopic" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #dbeafe; padding: 12px 18px; border-radius: 20px; border: 3px solid #4f46e5; font-weight: bold; cursor: move; font-size: 1.1em;">
                            Climate Change
                        </div>
                    </div>

                    <div style="margin: 15px 0; padding: 15px; background: #fffbeb; border-radius: 8px; border-left: 4px solid #f59e0b;">
                        <strong>üí° Hierarchical Mind Mapping Tips:</strong><br>
                        ‚Ä¢ <strong>Main branches</strong> are colored and bold (connected to center)<br>
                        ‚Ä¢ <strong>Sub-nodes</strong> are gray and smaller (connected to their parent)<br>
                        ‚Ä¢ <strong>Lines show relationships:</strong> solid for main, dashed for sub-connections<br>
                        ‚Ä¢ <strong>Try this structure:</strong> Causes ‚Üí Fossil Fuels ‚Üí Coal, Oil, Gas<br>
                        ‚Ä¢ <strong>Keep it visual:</strong> Arrange related concepts close together
                    </div>
                </div>
            `;
        }

        function createChartingWalkthrough() {
            return `
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Create columns:</strong> Set up column headers based on the categories you need to compare.
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Add rows:</strong> Each row represents a different item, concept, or time period you're studying.
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Fill systematically:</strong> Complete each cell with relevant information, keeping entries concise.
                </div>

                <div class="visual-example">
                    <table style="width: 100%; border-collapse: collapse; background: white;">
                        <tr style="background: #4f46e5; color: white;">
                            <th style="border: 1px solid #ddd; padding: 10px;">Planet</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Distance from Sun</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Size</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Composition</th>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 10px; background: #fef3c7;">Mercury</td>
                            <td style="border: 1px solid #ddd; padding: 10px;">0.39 AU</td>
                            <td style="border: 1px solid #ddd; padding: 10px;">Smallest</td>
                            <td style="border: 1px solid #ddd; padding: 10px;">Rocky</td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 10px; background: #dcfce7;">Venus</td>
                            <td style="border: 1px solid #ddd; padding: 10px;">0.72 AU</td>
                            <td style="border: 1px solid #ddd; padding: 10px;">Earth-like</td>
                            <td style="border: 1px solid #ddd; padding: 10px;">Rocky</td>
                        </tr>
                    </table>
                </div>

                <div class="interactive-demo">
                    <h4>Practice charting:</h4>
                    <p>Create a chart comparing different note-taking methods:</p>
                    <table id="chartingTable" style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                        <tr style="background: #f3f4f6;">
                            <th style="border: 1px solid #ddd; padding: 10px;">Method</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Best For</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Speed</th>
                            <th style="border: 1px solid #ddd; padding: 10px;">Organization</th>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 5px;">Cornell</td>
                            <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" id="cornell_bestfor" style="width: 100%; border: none; padding: 2px;" placeholder="Fill this in..."></td>
                            <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" id="cornell_speed" style="width: 100%; border: none; padding: 2px;" placeholder="Rate 1-5"></td>
                            <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" id="cornell_org" style="width: 100%; border: none; padding: 2px;" placeholder="Rate 1-5"></td>
                        </tr>
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 5px;">Outline</td>
                            <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" id="outline_bestfor" style="width: 100%; border: none; padding: 2px;" placeholder="Fill this in..."></td>
                            <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" id="outline_speed" style="width: 100%; border: none; padding: 2px;" placeholder="Rate 1-5"></td>
                            <td style="border: 1px solid #ddd; padding: 5px;"><input type="text" id="outline_org" style="width: 100%; border: none; padding: 2px;" placeholder="Rate 1-5"></td>
                        </tr>
                    </table>
                    <div style="margin-top: 10px;">
                        <button onclick="checkChartingAnswers()" class="btn" style="font-size: 0.9em; padding: 8px 15px;">Check Answers</button>
                        <button onclick="addChartRow()" class="btn btn-secondary" style="font-size: 0.9em; padding: 8px 15px;">Add Row</button>
                        <button onclick="clearChartingDemo()" class="btn btn-secondary" style="font-size: 0.9em; padding: 8px 15px;">Clear</button>
                    </div>
                    <div id="chartingFeedback" style="margin-top: 10px; padding: 10px; background: #f0f9ff; border-radius: 6px; display: none;"></div>
                </div>
            `;
        }

        function createSentenceWalkthrough() {
            return `
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Number each point:</strong> Start each new idea or fact with a number (1, 2, 3...).
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>One idea per line:</strong> Write each significant point as a separate, complete sentence.
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Capture everything:</strong> Don't worry about organization during class - focus on getting all information down.
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Review and organize later:</strong> After class, group related sentences and highlight key points.
                </div>

                <div class="visual-example">
                    <strong>Example Sentence Method Notes:</strong><br><br>
                    1. Photosynthesis is the process plants use to make their own food.<br>
                    2. It requires sunlight, water, and carbon dioxide.<br>
                    3. Chlorophyll in leaves captures the sunlight energy.<br>
                    4. The chemical equation is 6CO2 + 6H2O ‚Üí C6H12O6 + 6O2.<br>
                    5. Oxygen is released as a byproduct of this process.<br>
                    6. This process is essential for life on Earth.<br>
                    7. Plants perform photosynthesis mainly in their leaves.<br>
                </div>

                <div class="interactive-demo">
                    <h4>Practice sentence method:</h4>
                    <p>Take notes on this fast-paced content about the American Revolution:</p>
                    <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin: 10px 0; font-size: 0.9em;">
                        <strong>Lecture excerpt:</strong> "The Boston Tea Party occurred in 1773 as protest against British taxation. Colonists dumped 342 chests of tea into Boston Harbor. This led to the Intolerable Acts in 1774. The First Continental Congress met in Philadelphia in September 1774. They organized a boycott of British goods. Tensions continued to rise leading to the battles of Lexington and Concord in 1775..."
                    </div>
                    <textarea id="sentenceNotes" class="demo-input" placeholder="Number each fact as you go:
1. 
2. 
3. ..." rows="8"></textarea>
                    <div style="margin-top: 10px;">
                        <button onclick="checkSentenceFormat()" class="btn" style="font-size: 0.9em; padding: 8px 15px;">Check Format</button>
                        <button onclick="autoNumber()" class="btn btn-secondary" style="font-size: 0.9em; padding: 8px 15px;">Auto-Number</button>
                        <button onclick="clearSentenceDemo()" class="btn btn-secondary" style="font-size: 0.9em; padding: 8px 15px;">Clear</button>
                    </div>
                    <div id="sentenceFeedback" style="margin-top: 10px; padding: 10px; background: #f0f9ff; border-radius: 6px; display: none;"></div>
                </div>
            `;
        }

        function createSketchnotingWalkthrough() {
            return `
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Start with structure:</strong> Create a basic layout using headings, boxes, or sections to organize your content.
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Add key text:</strong> Write main ideas and important facts in different text sizes - bigger for main concepts.
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Draw simple visuals:</strong> Add basic shapes, icons, arrows, and symbols to represent concepts visually.
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Connect ideas:</strong> Use arrows, lines, and visual flow to show relationships between concepts.
                </div>

                <div class="visual-example">
                    <strong>Sketchnoting Elements:</strong><br><br>
                    üìö <strong>Books/Learning</strong> ‚Üí Use book icons<br>
                    üí° <strong>Ideas</strong> ‚Üí Lightbulb symbols<br>
                    ‚≠ê <strong>Important</strong> ‚Üí Stars or emphasis<br>
                    ‚û°Ô∏è <strong>Process</strong> ‚Üí Arrows and flow<br>
                    üìä <strong>Data</strong> ‚Üí Simple charts/graphs<br>
                    ‚ùì <strong>Questions</strong> ‚Üí Question marks in bubbles<br>
                    ‚úÖ <strong>Key Points</strong> ‚Üí Checkmarks or boxes
                </div>

                <div class="interactive-demo">
                    <h4>Try sketchnoting about "The Water Cycle":</h4>
                    <p>Create a visual sketch combining text and drawings to explain the water cycle process.</p>
                    
                    <div style="margin: 15px 0;">
                        <input type="text" id="sketchTextInput" placeholder="Type text to add to your sketch..." style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; margin-right: 10px; width: 250px;">
                        <button onclick="addSketchText()" class="btn" style="font-size: 0.9em; padding: 8px 15px;">Add Text</button>
                    </div>

                    <div style="margin: 15px 0;">
                        <strong>Quick Symbols:</strong>
                        <button onclick="addSketchSymbol('‚òÄÔ∏è')" style="margin: 2px; padding: 5px 8px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">‚òÄÔ∏è</button>
                        <button onclick="addSketchSymbol('‚òÅÔ∏è')" style="margin: 2px; padding: 5px 8px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">‚òÅÔ∏è</button>
                        <button onclick="addSketchSymbol('üåä')" style="margin: 2px; padding: 5px 8px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">üåä</button>
                        <button onclick="addSketchSymbol('üíß')" style="margin: 2px; padding: 5px 8px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">üíß</button>
                        <button onclick="addSketchSymbol('‚û°Ô∏è')" style="margin: 2px; padding: 5px 8px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">‚û°Ô∏è</button>
                        <button onclick="addSketchSymbol('‚¨ÜÔ∏è')" style="margin: 2px; padding: 5px 8px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">‚¨ÜÔ∏è</button>
                        <button onclick="addSketchSymbol('‚¨áÔ∏è')" style="margin: 2px; padding: 5px 8px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer;">‚¨áÔ∏è</button>
                    </div>

                    <canvas id="sketchCanvas" width="600" height="400" style="border: 2px solid #d1d5db; border-radius: 8px; background: white; display: block; margin: 15px 0; cursor: crosshair;"></canvas>

                    <div style="margin-top: 10px;">
                        <button onclick="provideSketchingTips()" class="btn" style="font-size: 0.9em; padding: 8px 15px;">Get Tips</button>
                        <button onclick="clearSketchCanvas()" class="btn btn-secondary" style="font-size: 0.9em; padding: 8px 15px;">Clear Canvas</button>
                        <button onclick="downloadSketch()" class="btn btn-secondary" style="font-size: 0.9em; padding: 8px 15px;">Download</button>
                    </div>
                    <div id="sketchingFeedback" style="margin-top: 10px; padding: 10px; background: #f0f9ff; border-radius: 6px; display: none;"></div>
                </div>
            `;
        }

        function backToResults() {
            document.querySelector('.walkthrough-section').style.display = 'none';
            document.querySelector('.walkthrough-section').classList.remove('active');
            document.querySelector('.results-section').style.display = 'block';
            document.querySelector('.results-section').classList.add('active');
        }

        function retakeQuiz() {
            startQuiz(); // Use the improved startQuiz function
        }

        // Mind map functionality with hierarchical support
        let mindMapNodes = [];
        let nodeCounter = 0;
        let isDragging = false;
        let currentDragNode = null;
        let dragOffset = { x: 0, y: 0 };

        function addMindMapNode(text = null, x = null, y = null, parentId = null) {
            const canvas = document.getElementById('mindMapCanvas');
            if (!canvas) return;

            const nodeText = text || (document.getElementById('newNodeText') ? document.getElementById('newNodeText').value.trim() : '');
            if (!nodeText) {
                alert('Please enter text for the node');
                return;
            }

            nodeCounter++;
            const colors = ['#fef3c7', '#dcfce7', '#fce7f3', '#e0e7ff', '#fed7d7'];
            const isSubNode = parentId !== null;
            const color = isSubNode ? '#f3f4f6' : colors[nodeCounter % colors.length]; // Gray for sub-nodes

            // Position nodes around the center or parent if coordinates not provided
            if (x === null || y === null) {
                if (parentId) {
                    // Position near parent node
                    const parent = mindMapNodes.find(n => n.id === parentId);
                    if (parent) {
                        const parentRect = parent.element.getBoundingClientRect();
                        const canvasRect = canvas.getBoundingClientRect();
                        const angle = Math.random() * 2 * Math.PI;
                        const radius = 60 + (Math.random() * 40); // 60-100px from parent
                        x = ((parentRect.left + parentRect.width/2 - canvasRect.left) / canvasRect.width) * 100 + Math.cos(angle) * (radius / canvasRect.width) * 100;
                        y = ((parentRect.top + parentRect.height/2 - canvasRect.top) / canvasRect.height) * 100 + Math.sin(angle) * (radius / canvasRect.height) * 100;
                    }
                } else {
                    // Position around center for main nodes
                    const angle = (nodeCounter * 60) * (Math.PI / 180);
                    const radius = 80 + (nodeCounter * 10);
                    x = 50 + Math.cos(angle) * radius;
                    y = 50 + Math.sin(angle) * radius;
                }
            }

            // Keep within bounds
            x = Math.max(10, Math.min(90, x));
            y = Math.max(10, Math.min(90, y));

            const node = document.createElement('div');
            node.className = 'mind-map-node';
            const fontSize = isSubNode ? '0.8em' : '0.9em';
            const padding = isSubNode ? '6px 10px' : '8px 12px';
            
            node.style.cssText = `
                position: absolute;
                left: ${x}%;
                top: ${y}%;
                transform: translate(-50%, -50%);
                background: ${color};
                padding: ${padding};
                border-radius: 15px;
                border: 2px solid ${isSubNode ? '#9ca3af' : '#6b7280'};
                cursor: move;
                font-size: ${fontSize};
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                z-index: 10;
                font-weight: ${isSubNode ? 'normal' : 'bold'};
            `;
            node.textContent = nodeText;
            node.dataset.nodeId = nodeCounter;
            node.dataset.parentId = parentId || '';

            // Add event listeners
            node.addEventListener('mousedown', startDrag);
            node.addEventListener('contextmenu', showNodeContextMenu);
            
            canvas.appendChild(node);
            
            const nodeData = { 
                id: nodeCounter, 
                element: node, 
                text: nodeText, 
                parentId: parentId,
                children: []
            };
            
            mindMapNodes.push(nodeData);

            // Update parent's children array
            if (parentId) {
                const parent = mindMapNodes.find(n => n.id === parentId);
                if (parent) {
                    parent.children.push(nodeCounter);
                }
            }

            // Clear input if it exists
            const input = document.getElementById('newNodeText');
            if (input) {
                input.value = '';
            }

            // Draw line to parent or center
            drawNodeConnections();
            return nodeCounter;
        }

        function showNodeContextMenu(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const nodeId = parseInt(e.target.dataset.nodeId);
            const existingMenu = document.querySelector('.context-menu');
            if (existingMenu) existingMenu.remove();

            const menu = document.createElement('div');
            menu.className = 'context-menu';
            menu.style.cssText = `
                position: fixed;
                left: ${e.clientX}px;
                top: ${e.clientY}px;
                background: white;
                border: 1px solid #d1d5db;
                border-radius: 6px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                padding: 8px 0;
                font-size: 0.9em;
                min-width: 120px;
            `;

            const addSubNodeOption = document.createElement('div');
            addSubNodeOption.style.cssText = `
                padding: 8px 16px;
                cursor: pointer;
                color: #374151;
                user-select: none;
            `;
            addSubNodeOption.textContent = '+ Add Sub-Node';
            addSubNodeOption.addEventListener('mouseenter', () => {
                addSubNodeOption.style.background = '#f3f4f6';
            });
            addSubNodeOption.addEventListener('mouseleave', () => {
                addSubNodeOption.style.background = 'white';
            });
            addSubNodeOption.addEventListener('click', (clickEvent) => {
                clickEvent.stopPropagation();
                const text = prompt('Enter text for the sub-node:');
                if (text && text.trim()) {
                    addMindMapNode(text.trim(), null, null, nodeId);
                }
                menu.remove();
            });

            menu.appendChild(addSubNodeOption);

            // Only add delete option for non-central nodes
            if (nodeId !== 0) {
                const deleteOption = document.createElement('div');
                deleteOption.style.cssText = `
                    padding: 8px 16px;
                    cursor: pointer;
                    color: #ef4444;
                    border-top: 1px solid #e5e7eb;
                    user-select: none;
                `;
                deleteOption.textContent = 'Delete Node';
                deleteOption.addEventListener('mouseenter', () => {
                    deleteOption.style.background = '#fef2f2';
                });
                deleteOption.addEventListener('mouseleave', () => {
                    deleteOption.style.background = 'white';
                });
                deleteOption.addEventListener('click', (clickEvent) => {
                    clickEvent.stopPropagation();
                    deleteNode(nodeId);
                    menu.remove();
                });
                menu.appendChild(deleteOption);
            }

            document.body.appendChild(menu);

            // Remove menu when clicking elsewhere
            setTimeout(() => {
                const removeMenu = (event) => {
                    if (!menu.contains(event.target)) {
                        menu.remove();
                        document.removeEventListener('click', removeMenu);
                    }
                };
                document.addEventListener('click', removeMenu);
            }, 100);
        }

        function deleteNode(nodeId) {
            const node = mindMapNodes.find(n => n.id === nodeId);
            if (!node) return;
            
            // Don't allow deleting the center node
            if (node.element.id === 'centralTopic') return;
            
            // Remove all children first
            const childrenToDelete = [...node.children];
            childrenToDelete.forEach(childId => deleteNode(childId));
            
            // Remove from parent's children array
            if (node.parentId) {
                const parent = mindMapNodes.find(n => n.id === node.parentId);
                if (parent) {
                    parent.children = parent.children.filter(id => id !== nodeId);
                }
            }
            
            // Remove from DOM and data
            node.element.remove();
            mindMapNodes = mindMapNodes.filter(n => n.id !== nodeId);
            
            // Redraw connections
            drawNodeConnections();
        }

        function drawNodeConnections() {
            const canvas = document.getElementById('mindMapCanvas');
            if (!canvas) return;

            // Remove existing SVG
            const existingSvg = canvas.querySelector('svg');
            if (existingSvg) existingSvg.remove();

            // Create new SVG
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.style.cssText = 'position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;';
            canvas.appendChild(svg);

            const canvasRect = canvas.getBoundingClientRect();
            const centerNode = document.getElementById('centralTopic');

            mindMapNodes.forEach(node => {
                if (node.element === centerNode) return;

                const nodeRect = node.element.getBoundingClientRect();
                let targetNode, targetRect;

                if (node.parentId) {
                    // Connect to parent node
                    const parent = mindMapNodes.find(n => n.id === node.parentId);
                    if (parent) {
                        targetNode = parent.element;
                        targetRect = targetNode.getBoundingClientRect();
                    }
                } else {
                    // Connect to center
                    targetNode = centerNode;
                    targetRect = centerNode.getBoundingClientRect();
                }

                if (!targetRect) return;

                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                const isSubNode = node.parentId !== null;
                
                line.setAttribute('stroke', isSubNode ? '#9ca3af' : '#6b7280');
                line.setAttribute('stroke-width', isSubNode ? '1.5' : '2');
                line.setAttribute('stroke-dasharray', isSubNode ? '3,3' : '5,5');
                
                const targetX = (targetRect.left + targetRect.width/2 - canvasRect.left);
                const targetY = (targetRect.top + targetRect.height/2 - canvasRect.top);
                const nodeX = (nodeRect.left + nodeRect.width/2 - canvasRect.left);
                const nodeY = (nodeRect.top + nodeRect.height/2 - canvasRect.top);

                line.setAttribute('x1', targetX);
                line.setAttribute('y1', targetY);
                line.setAttribute('x2', nodeX);
                line.setAttribute('y2', nodeY);
                line.dataset.nodeId = node.id;

                svg.appendChild(line);
            });
        }

        function startDrag(e) {
            isDragging = true;
            currentDragNode = e.target;
            const rect = currentDragNode.getBoundingClientRect();
            const canvasRect = document.getElementById('mindMapCanvas').getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left - rect.width/2;
            dragOffset.y = e.clientY - rect.top - rect.height/2;
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
            e.preventDefault();
        }

        function drag(e) {
            if (!isDragging || !currentDragNode) return;
            
            const canvas = document.getElementById('mindMapCanvas');
            const canvasRect = canvas.getBoundingClientRect();
            
            const x = ((e.clientX - dragOffset.x - canvasRect.left) / canvasRect.width) * 100;
            const y = ((e.clientY - dragOffset.y - canvasRect.top) / canvasRect.height) * 100;
            
            // Keep within bounds
            const boundedX = Math.max(5, Math.min(95, x));
            const boundedY = Math.max(5, Math.min(95, y));
            
            currentDragNode.style.left = boundedX + '%';
            currentDragNode.style.top = boundedY + '%';
            
            // Update connections
            drawNodeConnections();
        }

        function stopDrag() {
            isDragging = false;
            currentDragNode = null;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
        }

        function clearMindMap() {
            const canvas = document.getElementById('mindMapCanvas');
            if (!canvas) return;

            // Remove all nodes except the center
            const nodes = canvas.querySelectorAll('.mind-map-node');
            nodes.forEach(node => node.remove());

            // Remove SVG lines
            const svg = canvas.querySelector('svg');
            if (svg) svg.remove();

            mindMapNodes = [];
            nodeCounter = 0;
        }

        function setupSketchingCanvas() {
            const canvas = document.getElementById('sketchCanvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;

            // Set up canvas
            ctx.strokeStyle = '#333333';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // Set white background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                lastX = e.clientX - rect.left;
                lastY = e.clientY - rect.top;
            }

            function draw(e) {
                if (!isDrawing) return;
                
                const rect = canvas.getBoundingClientRect();
                const currentX = e.clientX - rect.left;
                const currentY = e.clientY - rect.top;

                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.stroke();

                lastX = currentX;
                lastY = currentY;
            }

            function stopDrawing() {
                isDrawing = false;
            }

            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Touch events for mobile
            canvas.addEventListener('touchstart', function(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });

            canvas.addEventListener('touchmove', function(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousemove', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });

            canvas.addEventListener('touchend', function(e) {
                e.preventDefault();
                const mouseEvent = new MouseEvent('mouseup', {});
                canvas.dispatchEvent(mouseEvent);
            });
        }

        // Initialize the application
        window.onload = function() {
            // Ensure all sections are properly hidden on load except intro
            hideAllSections();
            
            // Show intro section
            const intro = document.querySelector('.intro-section');
            if (intro) {
                intro.style.display = 'block';
            }
        };
    </script>
</body>
</html>